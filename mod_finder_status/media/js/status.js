
var FinderStatus=new Class({totalItems:null,batchSize:null,offset:null,path:'index.php?option=com_finder&tmpl=component&format=json&protocol=json&task=updater.update',ajax:null,initialize:function(){this.offset=0;this.ajax=new Ajax(this.path,{method:'get',evalScripts:true});this.ajax.addEvent('onComplete',this.handleResponse.bind(this));this.ajax.addEvent('onFailure',this.handleResponse.bind(this));this.ajax.request()},handleResponse:function(resp){json=Json.evaluate(resp,true);if(json==null||json.error==true){if(this.pb)$(this.pb.options.container).remove();var message=json?json.message:'The following message was returned by the server: <br />'+resp
$('finder-status-message').setHTML(message).addClass('finder-error');}else{if(json.setup)this.totalItems=json.totalItems;this.offset+=json.batchOffset;$('finder-status-message').setHTML(json.message);if(!json.finished){this.ajax.request();}}}});window.addEvent('domready',function(){Indexer=new FinderStatus();});